# 单元测试

## 这次分享要达到的目标

- 快速上手编写单元测试用例

## 提纲

1. 单元测试是什么，如何写一个单元测试
2. 从如何写引出三点步骤
3. 测试单元指的什么-》mock介绍-》snapshot介绍
4. 实例展示（两个例子）
5. 辩证看待。unit test的成本、收益、局限性

## 草稿

今天的分享主题是单元测试，使用的测试框架是jest。此次分享的核心目标是让不了解jest不了解单元测试的同学对其有个印象。分享主要有两部分：
一、如何写一个单元测试
二、实例展示
写一个单元测试用例分为三步：
1、2、3
第一步，确定测试单元。所谓测试单元是指程序的最小可测试部件，在面向对象的程序设计中，测试单元就是函数方法。我们前端的UI组件，也可以看成是一种函数。
第二步，确定输入并运行测试单元，这里有一个问题，我们该怎么处理程序的外部依赖，比如说测试单元A调用了函数B，如果我们直接引入B，那么将来B的变动就会影响到A用例的执行结果，但事实上我们并不在乎B是如何工作的，我们只关心它给我们想要的那个输出结果。只要能拿到结果，我们的A就可以继续执行。因此，我们需要在执行测试用例时，让测试单元不再依赖外部模块的工作细节，可以通过mock的方式来实现这一目标。mock的作用是模拟一个假的依赖。这里的模拟受开发者控制。在稍后的例子中，我们会具体看看什么是mock。
第三步、检验输出。就是看结果是不是我们想要的，常用的方式有断言语句和snapshot,snapshot是一种非常懒人的方式，能够让开发者快速感知到底层的变动。当我们使用snapshot时，jest会在代码库里把运行结果生成一份快照文件，随后每次运行测试用例，都会对比快照是否发生变化，如果变化，用例就不会运行通过，并给出详细的提示。因此，快照文件要作为代码库的一部分提交到git仓库中。
接下来展示两个例子，第一个例子展示了单元测试怎么帮助我们提早发现bug, 第二个例子展示了如何用snapshot为UI组件编写单元测试。

观察可得，接口请求的作用是返回一个数据对象，这个数据对象有几种可能的错误码，还有可能会抛出一个异常，所以我们的mock也要覆盖到以上所有情况。
